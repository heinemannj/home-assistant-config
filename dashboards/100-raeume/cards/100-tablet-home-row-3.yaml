type: custom:layout-card
layout_type: custom:grid-layout
cards:
  - !include /config/dashboards/420-pv/cards/420-pv-power-flow-card.yaml
  - type: vertical-stack
    cards:
      - type: horizontal-stack
        cards:
          - !include /config/dashboards/420-pv/cards/420-pv-solar-power-gauge-card.yaml
          - !include /config/dashboards/420-pv/cards/420-pv-battery-capacity-gauge-card.yaml
          - !include /config/dashboards/420-pv/cards/420-pv-self-sufficiency-gauge-card.yaml
        card_mod:
          style: |
            ha-card {
              width: 470px;
              height: 100px !important;
              }
      - type: custom:apexcharts-card
        header:
          show: false
        apex_config:
          chart:
            height: 250px
        graph_span: 3d
        now:
          show: true
          color: grey
          label: Now
        span:
          start: day
          offset: "-1day"
        all_series_config:
          type: area
          opacity: 0.3
          stroke_width: 1
        series:
          - entity: sensor.battery_state_of_capacity
            name: Batterie
            float_precision: 0
            type: line
            color: "#f06292"
            opacity: 0.6
            yaxis_id: capacity
            extend_to: now
            group_by:
              func: last
              duration: 5m
          - entity: sensor.house_consumption_power
            name: Haus
            float_precision: 3
            type: line
            color: MediumAquaMarine
            opacity: 0.8
            yaxis_id: kWh
            unit: kW
            transform: return x/1000;
            extend_to: now
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.inverter_input_power
            name: Solar
            float_precision: 3
            color: Orange
            yaxis_id: kWh
            unit: kW
            transform: return x/1000;
            extend_to: now
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.solcast_forecast_today
            name: Forecast D1
            color: grey
            opacity: 0.3
            stroke_width: 0
            yaxis_id: kWh
            show:
              legend_value: false
            data_generator: |
              return entity.attributes.forecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate];
                  });
          - entity: sensor.solcast_forecast_tomorrow
            name: Forecast D2
            float_precision: 0
            color: grey
            opacity: 0.3
            stroke_width: 0
            yaxis_id: kWh
            show:
              legend_value: false
            data_generator: |
              return entity.attributes.forecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate];
                  });
        yaxis:
          - id: capacity
            show: true
            opposite: true
            decimals: 0
            max: 100
            min: 0
            apex_config:
              tickAmount: 5
          - id: kWh
            show: true
            min: 0
            apex_config:
              tickAmount: 5
        card_mod:
          style: |
            ha-card {
              width: 470px;
              height: 250px !important;
              }
  - !include /config/dashboards/420-pv/cards/420-pv-energy-flow-card.yaml
layout:
  grid-template-columns: 365px 475px 365px
  margin: 0px;
  padding: 0px;
