type: custom:layout-card
layout_type: custom:grid-layout
cards:
  - type: custom:power-flow-card-plus
    title: Power Flows (Now)
    min_flow_rate: 0.75
    max_flow_rate: 6
    watt_threshold: 9999
    kw_decimals: 3
    w_decimals: 0
    clickable_entities: true
    display_zero_lines: true
    use_new_flow_rate_model: true
    entities:
      home:
        entity: sensor.house_consumption_power
        override_state: true
      solar:
        entity: sensor.inverter_input_power
      battery:
        entity: sensor.battery_charge_discharge_power_with_loss
        state_of_charge: sensor.battery_state_of_capacity
        color_circle: true
      grid:
        entity: sensor.power_meter_active_power
      fossil_fuel_percentage:
        entity: sensor.co2_signal_grid_fossil_fuel_percentage
        icon: mdi:pine-tree
        color_icon: true
        display_zero: true
        name: Low-carbon
        state_type: power
    inverted_entities: grid,battery
    card_mod: !include /config/custom_templates/power-flow-card-mod.yaml
  - type: vertical-stack
    cards:
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.inverter_input_power
            name: Solar Power
            min: 0
            max: 9000
            needle: true
            segments:
              - from: 0
                color: red
              - from: 350
                color: orange
              - from: 700
                color: yellow
              - from: 2800
                color: green
            card_mod:
              style:
                .: |
                  ha-card {
                    width: 152px;
                    height: 100px !important;
                    }
                  .name {
                    font-size: 12px !important;
                    margin-top: 2px !important;
                    }
                  ha-gauge {
                    width: 120% !important;
                    }
                ha-gauge$: |
                  svg text {
                    transform: scale(0.8) translateY(0px);
                  }
          - type: gauge
            entity: sensor.battery_state_of_capacity
            name: Battery Capacity
            min: 0
            max: 100
            needle: true
            segments:
              - from: 0
                color: red
              - from: 3
                color: orange
              - from: 24
                color: yellow
              - from: 72
                color: green
            card_mod:
              style:
                .: |
                  ha-card {
                    width: 152px;
                    height: 100px !important;
                    }
                  .name {
                    font-size: 12px !important;
                    margin-top: 2px !important;
                  }
                  ha-gauge {
                    width: 120% !important;
                  }
                ha-gauge$: |
                  svg text {
                    transform: scale(0.7) translateY(0px);
                  }
          - type: gauge
            entity: sensor.house_self_sufficiency_daily
            name: Self Sufficienty
            min: 0
            max: 100
            needle: true
            segments:
              - from: 0
                color: red
              - from: 65
                color: orange
              - from: 75
                color: yellow
              - from: 85
                color: green
            card_mod:
              style:
                .: |
                  ha-card {
                    width: 152px;
                    height: 100px !important;
                    }
                  .name {
                    font-size: 12px !important;
                    margin-top: 2px !important;
                  }
                  ha-gauge {
                    width: 120% !important;
                  }
                ha-gauge$: |
                  svg text {
                    transform: scale(0.7) translateY(0px);
                  }
        card_mod:
          style: |
            ha-card {
              width: 470px;
              height: 100px !important;
              }
      - type: custom:apexcharts-card
        header:
          show: false
        apex_config:
          chart:
            height: 250px
        graph_span: 3d
        now:
          show: true
          color: grey
          label: Now
        span:
          start: day
          offset: "-1day"
        all_series_config:
          type: area
          opacity: 0.3
          stroke_width: 1
        series:
          - entity: sensor.battery_state_of_capacity
            name: Batterie
            float_precision: 0
            type: line
            color: "#f06292"
            opacity: 0.6
            yaxis_id: capacity
            extend_to: now
            group_by:
              func: last
              duration: 5m
          - entity: sensor.house_consumption_power
            name: Haus
            float_precision: 3
            type: line
            color: MediumAquaMarine
            opacity: 0.8
            yaxis_id: kWh
            unit: kW
            transform: return x/1000;
            extend_to: now
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.inverter_input_power
            name: Solar
            float_precision: 3
            color: Orange
            yaxis_id: kWh
            unit: kW
            transform: return x/1000;
            extend_to: now
            group_by:
              func: avg
              duration: 5m
          - entity: sensor.solcast_forecast_today
            name: Forecast D1
            color: grey
            opacity: 0.3
            stroke_width: 0
            yaxis_id: kWh
            show:
              legend_value: false
            data_generator: |
              return entity.attributes.forecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate];
                  });
          - entity: sensor.solcast_forecast_tomorrow
            name: Forecast D2
            float_precision: 0
            color: grey
            opacity: 0.3
            stroke_width: 0
            yaxis_id: kWh
            show:
              legend_value: false
            data_generator: |
              return entity.attributes.forecast.map((entry) => {
                    return [new Date(entry.period_start), entry.pv_estimate];
                  });
        yaxis:
          - id: capacity
            show: true
            opposite: true
            decimals: 0
            max: 100
            min: 0
            apex_config:
              tickAmount: 5
          - id: kWh
            show: true
            min: 0
            apex_config:
              tickAmount: 5
        card_mod:
          style: |
            ha-card {
              width: 470px;
              height: 250px !important;
              }
  - type: custom:energy-flow-card-plus
    title: Energy Flows (Today)
    min_flow_rate: 3
    max_flow_rate: 10
    wh_kwh_threshold: 0
    kwh_decimals: 2
    wh_decimals: 2
    energy_date_selection: false
    clickable_entities: true
    entities:
      home:
        entity: sensor.house_consumption_energy_daily
        override_state: false
      solar:
        entity: sensor.solar_yield_daily
      battery:
        entity:
          consumption: sensor.battery_day_discharge_with_loss
          production: sensor.battery_day_charge_with_loss
        state_of_charge: sensor.battery_state_of_capacity
        color_circle: true
      grid:
        entity:
          consumption: sensor.power_meter_consumption_energy_daily
          production: sensor.power_meter_exported_energy_daily
      fossil_fuel_percentage:
        entity: sensor.co2_signal_grid_fossil_fuel_percentage
        icon: mdi:pine-tree
        color_icon: true
        display_zero: true
        name: Low-carbon
        state_type: kWh
    card_mod: !include /config/custom_templates/power-flow-card-mod.yaml
layout:
  grid-template-columns: 365px 475px 365px
  margin: 0px;
  padding: 0px;
