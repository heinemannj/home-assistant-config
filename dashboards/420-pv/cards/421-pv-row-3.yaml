type: custom:layout-card
layout_type: custom:grid-layout
cards:
  - type: custom:apexcharts-card
    config_templates: pv_radial_chart
    header:
      title: Solar Yield - Self Use
    series:
      - entity: sensor.inverter_yield_self_use_total
        name: Total
        transform: >
          let inv_yield =
          hass.states['sensor.inverter_total_yield'].state; let
          inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_total'].state;

          return(inv_yield_self_use / inv_yield * 100);
      - entity: sensor.inverter_yield_self_use_yearly
        name: Year
        transform: >
          let inv_yield =
          hass.states['sensor.inverter_yield_yearly'].state; let
          inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_yearly'].state;
          return(inv_yield_self_use / inv_yield * 100);
      - entity: sensor.inverter_yield_self_use_monthly
        name: Month
        transform: >
          let inv_yield =
          hass.states['sensor.inverter_yield_monthly'].state; let
          inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_monthly'].state;
          return(inv_yield_self_use / inv_yield * 100);
      - entity: sensor.inverter_yield_self_use_weekly
        name: Week
        transform: >
          let inv_yield =
          hass.states['sensor.inverter_yield_weekly'].state; let
          inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_weekly'].state;
          return(inv_yield_self_use / inv_yield * 100);
      - entity: sensor.inverter_yield_self_use_daily
        name: Today
        transform: >
          let inv_yield =
          hass.states['sensor.inverter_daily_yield'].state; let
          inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_daily'].state;
          return(inv_yield_self_use / inv_yield * 100);
    card_mod: !include /config/dashboards/420-pv/templates/421-pv-row-3-card-mod.yaml
  - type: custom:apexcharts-card
    config_templates: pv_radial_chart
    header:
      title: Solar Yield - Self Sufficiency
    series:
      - entity: sensor.inverter_yield_self_use_total
        name: Total
        transform: >
          let inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_total'].state; let
          house_consumption =
          hass.states['sensor.house_consumption_energy_total'].state;
          return(inv_yield_self_use / house_consumption * 100);
      - entity: sensor.inverter_yield_self_use_yearly
        name: Year
        transform: >
          let inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_yearly'].state;
          let house_consumption =
          hass.states['sensor.house_consumption_energy_yearly'].state;
          return(inv_yield_self_use / house_consumption * 100);
      - entity: sensor.inverter_yield_self_use_monthly
        name: Month
        transform: >
          let inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_monthly'].state;
          let house_consumption =
          hass.states['sensor.house_consumption_energy_monthly'].state;
          return(inv_yield_self_use / house_consumption * 100);
      - entity: sensor.inverter_yield_self_use_weekly
        name: Week
        transform: >
          let inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_weekly'].state;
          let house_consumption =
          hass.states['sensor.house_consumption_energy_weekly'].state;
          return(inv_yield_self_use / house_consumption * 100);
      - entity: sensor.inverter_yield_self_use_daily
        name: Today
        transform: >
          let inv_yield_self_use =
          hass.states['sensor.inverter_yield_self_use_daily'].state; let
          house_consumption =
          hass.states['sensor.house_consumption_energy_daily'].state;
          return(inv_yield_self_use / house_consumption * 100);
    card_mod: !include /config/dashboards/420-pv/templates/421-pv-row-3-card-mod.yaml
  - type: custom:apexcharts-card
    config_templates: pv_donut_chart
    header:
      title: Solar Yield - Usage (Today)
    series:
      - entity: sensor.solar_yield_daily
        name: Production
        color: "#ff9800"
        show:
          in_chart: false
      - entity: sensor.power_meter_exported_energy_daily
        name: Export
        color: "#488fc2"
      - entity: sensor.house_consumption_solar_energy_daily
        name: House
        color: MediumAquaMarine
      - entity: sensor.battery_day_charge_with_loss
        name: Bat-In
        color: "#f06292"
    card_mod: !include /config/dashboards/420-pv/templates/421-pv-row-3-card-mod.yaml
  - type: custom:apexcharts-card
    config_templates: pv_donut_chart
    header:
      title: House - Consumption (Today)
    series:
      - entity: sensor.house_consumption_energy_daily
        name: Load
        color: MediumAquaMarine
        show:
          in_chart: false
      - entity: sensor.power_meter_consumption_energy_daily
        name: Import
        color: "#488fc2"
      - entity: sensor.house_consumption_solar_energy_daily
        name: Solar
        color: "#ff9800"
      - entity: sensor.battery_day_discharge_with_loss
        name: Bat-Out
        color: "#f06292"
    card_mod: !include /config/dashboards/420-pv/templates/421-pv-row-3-card-mod.yaml
  - type: custom:apexcharts-card
    config_templates: pv_donut_chart
    header:
      title: Inverter - Input/Output (Today)
    series:
      - entity: sensor.solar_yield_daily
        name: Inv-In
        color: "#ff9800"
        show:
          in_chart: false
      - entity: sensor.battery_day_discharge
        name: Bat-Out
        color: "#ff9800"
        show:
          in_chart: false
      - entity: sensor.battery_day_charge
        name: Bat-In
        color: "#f06292"
      - entity: sensor.inverter_daily_yield
        name: Inv-Out
        color: MediumAquaMarine
      - entity: sensor.inverter_loss_daily
        name: Inv-Loss
        color: red
    card_mod:
      style: |
        ha-card {
          width: 295px !important;
          height: 300px !important;
          }
        #state__value > #state {
            font-size: 0.8em !important;
        }
        #state__value > #uom {
            font-size: 0.6em !important;
        }
  - type: custom:apexcharts-card
    config_templates: pv_donut_chart
    header:
      title: Inverter - Loss (Today)
    series:
      - entity: sensor.inverter_loss_daily
        name: Total
        color: "#ff9800"
        show:
          in_chart: false
      - entity: input_number.battery_charge_loss_daily
        name: Bat-In
        color: "#f06292"
      - entity: input_number.battery_discharge_loss_daily
        name: Bat-Out
        color: MediumAquaMarine
    card_mod: !include /config/dashboards/420-pv/templates/421-pv-row-3-card-mod.yaml
layout:
  grid-template-columns: 270px 270px 270px 270px 300px 270px
  margin: 0px;
  padding: 0px;
